{% extends "shop/checkout/dialog-base.html" %}
{% load i18n static sass_tags sekizai_tags %}

{% block extra-styles %}
	{{ block.super }}
	{% addtoblock "css" %}<link href="{% sass_src 'shop/css/method-form.scss' %}" rel="stylesheet" type="text/css" />{% endaddtoblock %}
{% endblock %}

{% block extra-scripts %}
	{{ block.super }}
	{% addtoblock "js" %}<script src="{% static 'shop/js/method-form.js' %}" type="text/javascript"></script>{% endaddtoblock %}
	{% add_data "ng-requires" "django.shop.method-form" %}
{% endblock %}

{% block dialog_form %}
<form shop-method-form djng-endpoint="{% url 'shop:checkout-upload' %}" name="{{ shipping_method_form.form_name }}" novalidate>
{% if shipping_method_form.has_choices %}
	{{ shipping_method_form.as_div }}
	{% if show_additional_charge %}
	<div class="additional-charge">
		{% for choice, label in shipping_method_form.shipping_modifier.field.choices %}
		<p ng-repeat="extra_row in cart.extra_rows|filter:{modifier:'{{ choice }}'}">{% trans "Additional charge" %}: {% verbatim %}{{ extra_row.amount }}{% endverbatim %}</p>
		{% endfor %}
		{% if shipping_modifiers.initial_row %}
		<p ng-if="!cart.extra_rows">{% trans "Additional charge" %}: {{ shipping_modifiers.initial_row.amount }}</p>
		{% endif %}

	</div>
	{% endif %}
{% else %}
	<input name="__force_invalidation__" style="display: none;" required />
	<p class="bg-danger">{% trans "No shipping method available" %}</p>
{% endif %}
</form>
<script>
	$('[name="shipping_method_form"]').ready(
	function(){
		$('label[for=shippingmethod_np_branch], #shippingmethod_np_branch').hide();
		$('label[for=shippingmethod_address], #shippingmethod_address').hide();
		$('label[for=shippingmethod_city], #shippingmethod_city').hide();
		$('label[for=shippingmethod_zip_code], #shippingmethod_zip_code').hide();
		$('label[for=shippingmethod_region], #shippingmethod_region').hide();
	}
	);
	$(function(){
  $('#shippingmethod_shipping_modifier input').change(function(){
    if ($(':input[value="nova-poshta-shipping"]').is(':checked'))
    {
      $('label[for=shippingmethod_np_branch], #shippingmethod_np_branch').show().prop('ng-ng-required', true);
      $('label[for=shippingmethod_city], #shippingmethod_city').show().prop('ng-required', true);
      $('label[for=shippingmethod_region], #shippingmethod_region').show().prop('ng-required', true);
      $('label[for=shippingmethod_zip_code], #shippingmethod_zip_code').hide().prop('ng-required', false);
      $('label[for=shippingmethod_address], #shippingmethod_address').hide().prop('ng-required', false);
    }
    else if ($(':input[value="postal-shipping"]').is(':checked'))
    {
	  $('label[for=shippingmethod_np_branch], #shippingmethod_np_branch').hide().prop('ng-required', false);
	  $('label[for=shippingmethod_address], #shippingmethod_address').show().prop('ng-required', true);
	  $('label[for=shippingmethod_city], #shippingmethod_city').show().prop('ng-required', true);
	  $('label[for=shippingmethod_zip_code], #shippingmethod_zip_code').show().prop('ng-required', true);
	  $('label[for=shippingmethod_region], #shippingmethod_region').show().prop('ng-required', true);
    }
    else if ($(':input[value="customer-pickup"]').is(':checked'))
    {
	  $('label[for=shippingmethod_np_branch], #shippingmethod_np_branch').hide().prop('ng-required', false);
	  $('label[for=shippingmethod_address], #shippingmethod_address').hide().prop('ng-required', false);
	  $('label[for=shippingmethod_city], #shippingmethod_city').hide().prop('ng-required', false);
	  $('label[for=shippingmethod_zip_code], #shippingmethod_zip_code').hide().prop('ng-required', false);
	  $('label[for=shippingmethod_region], #shippingmethod_region').hide().prop('ng-required', false);
    }
  });
  $(document).ready( function (){
  	$(':input[value="customer-pickup"]').click();
  });
});
</script>
	{% block shipping-provider-form %}{% endblock %}
{% endblock %}
